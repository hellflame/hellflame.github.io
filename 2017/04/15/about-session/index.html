<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>关于 Session | Hellflame</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="basics,python,"><meta name="description" content="pleased or sad, everything dies with hellflame"><link rel="alternate" href="/atom.xml" title="Hellflame" type="application/atom+xml"><link rel="icon" href="/images/favicon.png"><link rel="apple-touch-icon" href="/images/favicon.png"><link href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="/icon/iconfont.css"><link rel="stylesheet" href="/css/github-markdown.css"><link rel="stylesheet" href="/css/highlight.css"><script src="/js/util.js"></script><script src="/js/valine.min.js"></script><link href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js" async></script><script src="/js/player.js"></script><link href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script></head><body><div id="app"><div class="header-wrap"><header><div class="site-brand"><div class="site-title"> <a href="/">Hellflame</a></div></div><nav class="site-navigation"><ul class="nav-menu"><li class="nav-item" data-path="/"> <a href="/" target="_self">首页</a></li><li class="nav-item" data-path="/archives/"> <a href="/archives/" target="_self">归档</a></li><li class="nav-item" data-path="/categories/"> <a href="/categories/" target="_self">分类</a></li><li class="nav-item" data-path="/tags/"> <a href="/tags/" target="_self">标签</a></li><li class="nav-item" data-path="/friends/"> <a href="/friends/" target="_self">友链</a></li><li class="nav-item" data-path="/about/"> <a href="/about/" target="_self">关于</a></li><li class="nav-item" data-path="https://github.com/hellflame"> <a href="https://github.com/hellflame" target="_self">Github</a></li></ul></nav><i class="iconfont icon-menu"></i></header></div><script src="/js/navigation.js"></script><div class="container post-index"><div class="post"><div style="position:fixed;right:1em;top:1.5em;cursor:pointer;z-index:999" onclick="toggleTOC()" id="toc"><div style="width:2em;height:2em"><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div></div></div><h1 class="article-title"> <span>关于 Session</span></h1><div class="article-top-meta"> <span>发布 : 2017-04-15</span> <span>分类 : <a href="/categories/basics/">basics</a></span> <span>浏览 : <span class="article-timer">--</span></span></div><div class="article-content"><div class="markdown-body"><blockquote><p><code>session</code> 其实只是一种存储手段，跟 <code>cookies</code> 的关系只能说是 手机和原装电池的关系。</p></blockquote><p>在 HTTP 请求报文中</p><ol><li>使用额外的header</li><li>在参数中添加特定字段</li><li>在请求体中添加特定数据结构</li></ol><p>就最终效果而言，都可以达到和 <code>cookies</code> 同样的作用。当然这里 <code>session</code> 的概念也就被扩展了</p><hr><p>由于之后可能会有从一个网站登陆，登陆状态在指定网站依然起效的情况，所以可能会涉及到相关问题的处理</p><p>在现在单一网站的情况下，一般是通过session来存储一个用户的登陆状态。在整个后台操作过程中，系统依靠判断session中这个标志状态来识别当前用户</p><p>经常和session一起使用的就是python中的装饰器了，在有权限控制的路由中，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route("/manager/test")</span></span><br><span class="line"><span class="meta">@env_check(allowance='manager')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxx</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">""</span></span><br></pre></td></tr></table></figure><p>装饰器的核心就是这个session</p><p>然而如果我有多台服务器，或者多台虚拟主机的时候，就需要session共享来实现这一步了</p><p>网上关于session共享倒是搜索到了很多</p><p><a href="http://www.cnblogs.com/wangtao_20/p/3395518.html" target="_blank" rel="noopener">session多服务器共享的方案梳理</a></p><p>上面介绍的方案无论是用memcached还是普通的非内存数据库（最好还是内存数据库），都是将session保存到数据库，这样大家都可以来操作一个session数据库，这也是在有学长第一次问道我该如何解决session共享问题时候的想法之一。但保存下session，最终其实是在维持一个session，如果用户数量不多的话还好，然而当用户数量急剧增加的时候，这就意味着要同时维持一个相当大的内存数据库，对于内存大小的要求不用说了，对数据库的搜索以及更新速度也有了更高的要求，然而我平时对于数据库基本上只是小型的应用，所以他们的性能什么的也不是很清楚，但是这个数据一定是很难想象的</p><p>以上方案对于内存的需求可能会越来越大，对于后期的维护来说可能也会变得困难，或者使用性能会逐渐低下，所以，在现在能够使用session的浏览器上，将数据存储到cookie应该是比较好的选择</p><p>将通过该浏览器进行登录后的数据加密的存储到cookie（现在的浏览器应该都是默认允许cookie的了吧，不然使用session也会成为一个问题），这样用户在验证个人信息的时候的大部分消耗应该在cookie的加密解密上或者再进一步读取服务器上有关用户的信息上了，就现有浏览器支持的cookie的个数以及大约4K的字符量来看的话，可以存储的信息真的很多了</p><p>这样的好处在于，即使服务器重启，内存数据库丢失，用户也不用重新登录，服务器内存压力也会降低，当然缺点也就来自于客户端的cookie了，cookie中存储不下太多东西，存在被盗取cookie后发生的一系列问题（session有被盗取的风险么，应该有，或者说和cookie一样的风险），好吧，还有破解cookie加密的问题，不过，，，大体看来，并没有太大问题。</p><p>下一个大型网站的时候就可以进行测试了捏～～～</p><blockquote><p>六 4 15 17:23:38 CST 2017</p></blockquote><p>现在服务器所使用的Session策略就是用加密的Cookies代替Session，同时会在加密的Cookies中存储验证是同一用户的关键字，比如用户的请求时间，IP等其他信息</p><p>虽然其实如果用Cookies来取代Session的话，可能带来的问题就是每一次HTTP请求都会变得十分臃肿，所以最好用加密的Cookies来保存尽量少的关键数据，在数据库中保存好与这条Cookies相关的数据，这样足以代替Session了的感觉</p></div></div><div class="copy-right"><div class="markdown-body"><blockquote> 本文作者 : hellflame<br> 原文链接 : <a href="">https://hellflame.github.io/2017/04/15/about-session/</a><br> 版权声明 : 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</blockquote></div></div><div class="social-share" style="margin-top:-2rem" data-wechat-qrcode-title="<p>微信扫一扫</p>" data-wechat-qrcode-helper="<p>微信右上角, 扫一扫分享</p>" data-sites="qzone, qq, weibo, facebook, twitter"> <span style="color:#6b7487;font-size:1.4rem">分享到:</span></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js" async></script><div class="article-footer"><div class="article-meta pull-left"><span><i class="iconfont icon-06tags"></i> 标签: <span class="span--tag"><a href="/tags/python/">#python</a></span></span></div><div class="article-meta pull-right"></div></div></div><aside id="sidebar"><p id="sidebar-header"></p><ol id="sidebar-toc"></ol></aside><script async>getTOC().length||$("#toc").remove()</script><nav class="post-navigation"><div class="nav-pre"><i class="iconfont icon-prev"></i> 上一篇: <a href="/2017/04/15/winter-holiday-end/" target="_self">寒假结束</a></div><div class="nav-next"> 下一篇: <a href="/2017/05/09/about-opensource/" target="_self">开源狂想(乱想)</a><i class="iconfont icon-next"></i></div></nav><a href="#comment" class="comment-anchor"></a><div class="comment-title"><i class="iconfont icon-footprint"></i> 留下足迹<i class="iconfont icon-footprint"></i></div> <a style="margin-bottom:1em;display:block;cursor:pointer" onclick="gotoComment()">点击通过issue留言</a><div id="vcomments"></div><script defer="defer">new Valine({el:"#vcomments",appId:"a",appKey:"b",notify:!1,verify:!1,avatar:"robohash",placeholder:"不填邮箱，网址, 也能收到回复哦♪(^∇^*)\n当然也不一定会回复-_-",path:getRealPath()})</script><script defer="defer">
   function gotoComment() {
    location.href = `https://github.com/hellflame/hellflame.github.io/issues/new?title=关于%0A“%E5%85%B3%E4%BA%8E%20Session”&body=%23%23%23%20[原文地址](https://hellflame.github.io/2017/04/15/about-session/)%0A%0A%23%23%23%20想说的话(问题/支持/异议)%20%20%0A%0A${document.getElementById('veditor').value}`
   }
   document.onreadystatechange = (e) => {
     if(document.readyState === 'complete') {
      setTimeout(() => {
        const target = document.getElementsByClassName("vsubmit vbtn")[0]
        target.outerHTML = target.outerHTML
        setTimeout(() => {
          document.getElementsByClassName("vsubmit vbtn")[0].addEventListener('click', gotoComment)
          console.log("event replaced")
        }, 1000)
        document.getElementsByClassName("power txt-right")[0].innerHTML = "Once powered by Valine"
      }, 1000)
     }
   }
 </script></div><footer><p class="site-info"> 博客已萌萌哒运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span><br> Theme - <a target="_blank" href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With 💗 | Powered by GodBMW & hellflame<br></p></footer><script src="/js/footer.js"></script><script>updateUptime(2016,3,27)</script><div class="back-to-top hidden"><span><i class="iconfont icon-60"></i><span></span> %</span></div><script src="/js/component/back-to-top.js"></script></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script src="/js/mathjax.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js" async></script><script async src="/js/fancybox.js"></script></body></html>