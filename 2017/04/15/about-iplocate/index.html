<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>ipLocate | Hellflame</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="works,python,shell,"><meta name="description" content="pleased or sad, everything dies with hellflame"><link rel="alternate" href="/atom.xml" title="Hellflame" type="application/atom+xml"><link rel="icon" href="/images/favicon.png"><link rel="apple-touch-icon" href="/images/favicon.png"><link href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="/icon/iconfont.css"><link rel="stylesheet" href="/css/github-markdown.css"><link rel="stylesheet" href="/css/highlight.css"><script src="/js/util.js"></script><script src="/js/valine.min.js"></script><link href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js" async></script><script src="/js/player.js"></script><link href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script></head><body><div id="app"><div class="header-wrap"><header><div class="site-brand"><div class="site-title"> <a href="/">Hellflame</a></div></div><nav class="site-navigation"><ul class="nav-menu"><li class="nav-item" data-path="/"> <a href="/" target="_self">首页</a></li><li class="nav-item" data-path="/archives/"> <a href="/archives/" target="_self">归档</a></li><li class="nav-item" data-path="/categories/"> <a href="/categories/" target="_self">分类</a></li><li class="nav-item" data-path="/tags/"> <a href="/tags/" target="_self">标签</a></li><li class="nav-item" data-path="/friends/"> <a href="/friends/" target="_self">友链</a></li><li class="nav-item" data-path="/corner-story/"> <a href="/corner-story/" target="_self">转角杀</a></li><li class="nav-item" data-path="/about/"> <a href="/about/" target="_self">关于</a></li><li class="nav-item" data-path="https://github.com/hellflame"> <a href="https://github.com/hellflame" target="_self">Github</a></li></ul></nav><i class="iconfont icon-menu"></i></header></div><script src="/js/navigation.js"></script><div class="container post-index"><div class="post"><div style="position:fixed;right:1em;top:1.5em;cursor:pointer;z-index:999" onclick="toggleTOC()" id="toc"><div style="width:2em;height:2em"><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div></div></div><h1 class="article-title"> <span>ipLocate</span></h1><div class="article-top-meta"> <span>发布 : 2017-04-15</span> <span>分类 : <a href="/categories/works/">works</a></span> <span>浏览 : <span class="article-timer">--</span></span></div><div class="article-content"><div class="markdown-body"><p></p><p>iplocate 是一个为了方便在终端环境通过ip或者域名获取其物理地址而生的程序</p><p>整个程序其实只是一个简单的网页爬虫而已，数据来源为<a href="http://ipinfo.io/" target="_blank" rel="noopener">http://ipinfo.io/</a>,本身并没有什么技术难点，本来还准备用国内的淘宝ip地址库来获取ip信息的，后来发现其实淘宝地址库中并没有太多关于ip来源具体位置的信息，就统一成了使用这个统一接口</p><p>这个程序的需求来自于曾经自己管理的服务器受到攻击，需要查明攻击者来源，判断其目的，当然首先判断攻击来源ip是否能访问，万一是肉鸡的话可能就需要联系对方网站管理员了，如果来源ip和来自同一个学校的话～～可能是学生们测试攻击手段或者同行的恶意攻击了，必要的话就需要屏蔽其ip了</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install iplocate</span><br></pre></td></tr></table></figure><h3 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h3><blockquote><p>*nix 操作系统<br>python 2.7<br>python 3.4</p></blockquote><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><blockquote><p>paramseeker</p></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>1.获取本机ip及相关信息<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iplocate</span><br></pre></td></tr></table></figure><p></p><p>2.获取某ip信息<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iplocate 210.42.122.245</span><br><span class="line">$ iplocate 2601:9:7680:363:75df:f491:6f85:352f</span><br></pre></td></tr></table></figure><p></p><p>3.获取某域名对应信息(该域名ip为本机实时获取)<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iplocate www.baidu.com</span><br></pre></td></tr></table></figure><p></p><p>4.关于iplocate<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iplocate -v</span><br><span class="line">$ iplocate -h</span><br></pre></td></tr></table></figure><p></p><h3 id="返回数据"><a href="#返回数据" class="headerlink" title="返回数据"></a>返回数据</h3><p>可能得到下列类似结果<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">     59.172.176.214</span><br><span class="line"></span><br><span class="line">LAT/LON             30.5801,114.2734</span><br><span class="line">Country             CN</span><br><span class="line">Region              Hubei</span><br><span class="line">City                Wuhan</span><br><span class="line">Hostname            214.176.172.59.broad.wh.hb.dynamic.163data.com.cn</span><br><span class="line">Network             AS4134 No.31,Jin-rong Street</span><br></pre></td></tr></table></figure><p></p><p>数据含义：<br> ip地址<br> 经纬度<br> 国家(缩写)<br> 地区<br> 城市<br> 主机名<br> 网络(AS号)<br> …</p><p> 可能出现的其他值<br> postal（邮编）<br> phone（电话）</p><h3 id="Github"><a href="#Github" class="headerlink" title="Github"></a><a href="https://github.com/hellflame/iplocate" target="_blank" rel="noopener">Github</a></h3><h3 id="IpLocate使用"><a href="#IpLocate使用" class="headerlink" title="IpLocate使用"></a>IpLocate使用</h3><p>这是一个内部封装的获取ip物理地址信息的类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> sys.version_info.major == <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">from</span> urllib2 <span class="keyword">import</span> urlopen, URLError</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen, URLError</span><br></pre></td></tr></table></figure><p>用于兼容py2以及py3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IpLocate.ip <span class="comment"># 用于保存目标ip地址，ipv6或ipv4</span></span><br><span class="line">IpLocate.host <span class="comment"># 通过域名来获取与域名绑定的ip的信息</span></span><br><span class="line">IpLocate.result <span class="comment"># 成功获取到数据之后的json数据保存于此</span></span><br></pre></td></tr></table></figure><p><code>ip</code>以及<code>host</code>的设置可以在初始化时赋值，可以单独为其中一个值初始化，若同时初始化，默认使用<code>ip</code>作为目标处理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IpLocate().my_locate() <span class="comment"># 获取执行程序的本机的ip数据，直接得到IpLocate.result</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IpLocate().his_locate() <span class="comment"># 获取指定ip或host的location信息</span></span><br></pre></td></tr></table></figure><p>内部获取域名ip的方式，通过<code>socket</code><br>（原本通过调用系统<code>ping</code>命令来获取结果，但是后来放弃了，有一下原因）</p><blockquote><ol><li>虽然类unix系统的<code>ping</code>命令差不多，但是windows下面<code>ping</code>参数些许不一样，比如设置timeout和ping多少次等，可以根据<code>platform</code>使用不同的<code>ping</code>参数，但是些许麻烦</li><li>通过<code>ping</code>返回结果获取域名ip的话，需要用正则表达式’’’’\((.+?)\)’’’’，在测试过程中发现某些情况下执行regular.find_all()会出现死递归，可能和python中执行正则的方式有关，具体原因自己也没有深入调查，所以没有用<code>ping</code></li><li>之所以使用<code>socket</code>来获取域名的<code>ip</code>主要是因为方便，<code>socket.gethostbyname(hostname)</code>会直接返回目标域名的ip地址，且方便设置<code>timeout</code></li></ol></blockquote><p>引用<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> IpLocate <span class="keyword">import</span> IpLocate</span><br></pre></td></tr></table></figure><p></p><p>以上为<code>IpLocate</code>的核心部分，实际在终端使用程序时通过<code>paramseeker</code>模块辅助实现，因为<code>paramseeker</code>还有很多需要改进的地方，顾用比较简单的程序来测试，终端运行程序为<a href="https://github.com/hellflame/iplocate/blob/master/IpLocate/run.py" target="_blank" rel="noopener">run.py</a></p></div></div><div class="copy-right"><div class="markdown-body"><blockquote> 本文作者 : hellflame<br> 原文链接 : <a href="">https://hellflame.github.io/2017/04/15/about-iplocate/</a><br> 版权声明 : 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</blockquote></div></div><div class="social-share" style="margin-top:-2rem" data-wechat-qrcode-title="<p>微信扫一扫</p>" data-wechat-qrcode-helper="<p>微信右上角, 扫一扫分享</p>" data-sites="qzone, qq, weibo, facebook, twitter"> <span style="color:#6b7487;font-size:1.4rem">分享到:</span></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js" async></script><div class="article-footer"><div class="article-meta pull-left"><span><i class="iconfont icon-06tags"></i> 标签: <span class="span--tag"><a href="/tags/python/">#python</a></span> <span class="span--tag"><a href="/tags/shell/">#shell</a></span></span></div><div class="article-meta pull-right"></div></div></div><aside id="sidebar"><p id="sidebar-header"></p><ol id="sidebar-toc"></ol></aside><script async>getTOC().length||$("#toc").remove()</script><nav class="post-navigation"><div class="nav-pre"><i class="iconfont icon-prev"></i> 上一篇: <a href="/2017/04/15/about-https/" target="_self">关于 HTTPS</a></div><div class="nav-next"> 下一篇: <a href="/2017/04/15/whu-network-issue/" target="_self">校园网验证漏洞</a><i class="iconfont icon-next"></i></div></nav><a href="#comment" class="comment-anchor"></a><div class="comment-title"><i class="iconfont icon-footprint"></i> 留下足迹<i class="iconfont icon-footprint"></i></div> <a style="margin-bottom:1em;display:block;cursor:pointer" onclick="gotoComment()">点击通过issue留言</a><div id="vcomments"></div><script defer="defer">new Valine({el:"#vcomments",appId:"a",appKey:"b",notify:!1,verify:!1,avatar:"robohash",placeholder:"不填邮箱，网址, 也能收到回复哦♪(^∇^*)\n当然也不一定会回复-_-",path:getRealPath()})</script><script defer="defer">
   function gotoComment() {
    location.href = `https://github.com/hellflame/hellflame.github.io/issues/new?title=关于%0A“ipLocate”&body=%23%23%23%20[原文地址](https://hellflame.github.io/2017/04/15/about-iplocate/)%0A%0A%23%23%23%20想说的话(问题/支持/异议)%20%20%0A%0A${document.getElementById('veditor').value}`
   }
   document.onreadystatechange = (e) => {
     if(document.readyState === 'complete') {
      setTimeout(() => {
        const target = document.getElementsByClassName("vsubmit vbtn")[0]
        target.outerHTML = target.outerHTML
        setTimeout(() => {
          document.getElementsByClassName("vsubmit vbtn")[0].addEventListener('click', gotoComment)
          console.log("event replaced")
        }, 1000)
        document.getElementsByClassName("power txt-right")[0].innerHTML = "Once powered by Valine"
      }, 1000)
     }
   }
 </script></div><footer><p class="site-info"> 博客已萌萌哒运行<span id="time-to-now"></span><span class="my-face">(●'◡'●)ﾉ♥</span><br> Theme - <a target="_blank" href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With 💗 | Powered by GodBMW & hellflame<br></p></footer><script src="/js/footer.js"></script><script>updateUptime(2016,3,27)</script><div class="back-to-top hidden"><span><i class="iconfont icon-60"></i><span></span> %</span></div><script src="/js/component/back-to-top.js"></script></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script src="/js/mathjax.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js" async></script><script async src="/js/fancybox.js"></script></body></html>