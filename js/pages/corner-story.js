!function(){function e(){return localStorage&&localStorage.setItem}const t={props:{title:String,content:String,choices:Array,show_choice:Boolean},data(){return{display_choice:this.show_choice}},methods:{make_a_choice(e){this.$emit("make_choice",e),this.display_choice=!1}},template:'<div class="choice">\n            <h4 class="choice-title">{{ title }}</h4>\n            <div class="choice-content markdown-body" v-html="content"></div>\n            <div class="choice-group" v-if="choices.length && display_choice">\n                <div class="choice-container" v-for="choice in choices" v-key="choice.hash">\n                    <h4 class="choice-next" @click="make_a_choice(choice.hash)">{{ choice.title }}</h4>\n                </div>\n            </div>\n            <div class="choice-reset" v-if="choices.length === 0">\n                <span class="button" @click="$emit(\'reset\')">RESET</span>\n                <span class="tip">as if it never happened</span>\n            </div>\n        </div>'};new Vue({el:"#corner-story",components:{choice:t},created(){const t=e()&&localStorage.route_path?JSON.parse(localStorage.route_path):[];this.loadChoice(void 0,0===t.length).then(()=>(this.loading=!0,new Promise(e=>{const c=t.slice(0,-1);!function t(o){const i=c[o];if(!i)return this.loading=!1,e();this.loadChoice(i,!1,!1).then(()=>{t(o+1)})}(0)}))).then(()=>{this.loadChoice(t.slice(-1)[0])})},methods:{reset(){e()&&localStorage.removeItem("route_path"),this.choices=[],this.loadChoice()},choice_made(t){this.loadChoice(t).then(c=>{c&&function(t){if(!e())return;let c=localStorage.route_path;(c=c?JSON.parse(c):[]).push(t),localStorage.route_path=JSON.stringify(c)}(t)})},loadChoice(e="index",t=!0,c=!0){return c&&(this.loading=!0),new Promise(o=>{(function(e="index"){return new Promise(t=>{$.get(`/corner-story/${e}.choice`).then(c=>{const o=e.split("").map(e=>e.charCodeAt(0)),i=o.length,h=[];atob(c).split("").forEach((e,t)=>h.push(e.charCodeAt(0)^o[t%i])),t(JSON.parse(decodeURIComponent(h.map(e=>String.fromCharCode(e)).join(""))))})})})(e).then(({title:c,content:i,branches:h})=>{this.choices.push({show_choice:t,key:e,title:c,content:i,choices:Object.entries(h).map(([e,t])=>({hash:t,title:e}))}),o(!0)}).catch(()=>{o(!1)}).finally(()=>{c&&(this.loading=!1)})})}},data:()=>({choices:[],loading:!1})})}();