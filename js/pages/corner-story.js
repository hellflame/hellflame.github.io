!function(){function e(){return localStorage&&localStorage.setItem}const c={props:{title:String,content:String,choices:Array,show_choice:Boolean},data(){return{display_choice:this.show_choice}},methods:{make_a_choice(e){this.$emit("make_choice",e),this.display_choice=!1}},template:'<div class="choice">\n            <h4 class="choice-title">{{ title }}</h4>\n            <div class="choice-content markdown-body" v-html="content"></div>\n            <div class="choice-group" v-if="choices.length && display_choice">\n                <div class="choice-container" \n                    v-for="choice in choices" \n                    v-key="choice.hash">\n                    <h4 class="choice-next" \n                        @click="make_a_choice(choice.hash)">{{ choice.title }}</h4>\n                </div>\n            </div>\n            <div class="choice-reset" \n                v-if="choices.length === 0">\n                <span class="button" @click="$emit(\'reset\')">RESET</span>\n                <span class="tip">as if it never happened</span>\n                </div>\n        </div>'};new Vue({el:"#corner-story",components:{choice:c},created(){const c=e()&&localStorage.route_path?JSON.parse(localStorage.route_path):[];this.load_choice(void 0,0===c.length),c.slice(0,-1).map(e=>this.load_choice(e,!1)),c.slice(-1).map(e=>this.load_choice(e))},methods:{reset(){e()&&localStorage.removeItem("route_path"),this.choices=[],this.load_choice()},choice_made(c){this.load_choice(c).then(o=>{o&&function(c){if(e()){let e=localStorage.route_path;(e=e?JSON.parse(e):[]).push(c),localStorage.route_path=JSON.stringify(e)}}(c)})},load_choice(e,c=!0){return this.loading=!0,new Promise(o=>{(function(e="index"){return new Promise(c=>{$.get(`/corner-story/${e}.choice`).then(o=>{const t=e.split("").map(e=>e.charCodeAt(0)),i=t.length,h=[];atob(o).split("").forEach((e,c)=>h.push(e.charCodeAt(0)^t[c%i])),c(decodeURIComponent(h.map(e=>String.fromCharCode(e)).join("")))})})})(e).then(t=>{const i=JSON.parse(t);this.choices.push({show_choice:c,key:e||"index",title:i.title,content:i.content,choices:Object.entries(i.branches).map(([e,c])=>({hash:c,title:e}))}),o(!0)}).catch(()=>{o(!1)}).finally(()=>{this.loading=!1})})}},data:()=>({choices:[],loading:!1})})}();