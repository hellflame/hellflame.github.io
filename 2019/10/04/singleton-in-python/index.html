<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>è§£æPythonä¸­çš„å•ä¾‹ | Hellflame</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="basics,python,"><meta name="description" content="pleased or sad, everything dies with hellflame"><link rel="alternate" href="/atom.xml" title="Hellflame" type="application/atom+xml"><link rel="icon" href="/images/favicon.png"><link rel="apple-touch-icon" href="/images/favicon.png"><link href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="/icon/iconfont.css"><link rel="stylesheet" href="/css/github-markdown.css"><link rel="stylesheet" href="/css/highlight.css"><script src="/js/util.js"></script><script src="/js/valine.min.js"></script><link href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js" async></script><script src="/js/player.js"></script><link href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script></head><body><div id="app"><div class="header-wrap"><header><div class="site-brand"><div class="site-title"> <a href="/">Hellflame</a></div></div><nav class="site-navigation"><ul class="nav-menu"><li class="nav-item" data-path="/"> <a href="/" target="_self">é¦–é¡µ</a></li><li class="nav-item" data-path="/archives/"> <a href="/archives/" target="_self">å½’æ¡£</a></li><li class="nav-item" data-path="/categories/"> <a href="/categories/" target="_self">åˆ†ç±»</a></li><li class="nav-item" data-path="/tags/"> <a href="/tags/" target="_self">æ ‡ç­¾</a></li><li class="nav-item" data-path="/friends/"> <a href="/friends/" target="_self">å‹é“¾</a></li><li class="nav-item" data-path="/corner-story/"> <a href="/corner-story/" target="_self">è½¬è§’æ€</a></li><li class="nav-item" data-path="/about/"> <a href="/about/" target="_self">å…³äº</a></li><li class="nav-item" data-path="https://github.com/hellflame"> <a href="https://github.com/hellflame" target="_self">Github</a></li></ul></nav><i class="iconfont icon-menu"></i></header></div><script src="/js/navigation.js"></script><div class="container post-index"><div class="post"><div style="position:fixed;right:1em;top:1.5em;cursor:pointer;z-index:999" onclick="toggleTOC()" id="toc"><div style="width:2em;height:2em"><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div><div style="width:100%;height:3px;background:silver;margin-bottom:3px"></div></div></div><h1 class="article-title"> <span>è§£æPythonä¸­çš„å•ä¾‹</span></h1><div class="article-top-meta"> <span>å‘å¸ƒ : 2019-10-04</span> <span>åˆ†ç±» : <a href="/categories/basics/">basics</a></span> <span>æµè§ˆ : <span class="article-timer">--</span></span></div><div class="article-content"><div class="markdown-body"><p>å•ä¾‹æ˜¯è½¯ä»¶è®¾è®¡æ¨¡å¼ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ¨¡å¼ï¼Œä¹Ÿæ˜¯æœ€æ–¹ä¾¿å®ç°çš„ä¸€ç§æ¨¡å¼ã€‚æ­£æ˜¯å› æ­¤ï¼Œå…¶å®ç°æ–¹å¼ä¹Ÿæ˜¯æœ€èƒ½å¤Ÿä½“ç°ä¸€ä¸ªäººå¯¹pythonåŸºç¡€çŸ¥è¯†çš„æŒæ¡æƒ…å†µçš„æ ‡å°º</p><h2 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h2><p>æ¯ä¸€ç§å•ä¾‹çš„å®ç°æ–¹å¼éƒ½ä¼šæœ‰å¾ˆå¤šå¯ä»¥è”ç³»åˆ°çš„åŸºç¡€çŸ¥è¯†</p><p>ä»¥ä¸‹æ ¹æ®è¯¥å•ä¾‹å­˜å‚¨çš„ä½ç½®èŒƒç•´ç”±å¤§åˆ°å°ä¾æ¬¡è¯´æ˜</p><h3 id="1-å…¨å±€å­˜å‚¨"><a href="#1-å…¨å±€å­˜å‚¨" class="headerlink" title="1. å…¨å±€å­˜å‚¨"></a>1. å…¨å±€å­˜å‚¨</h3><p>ä¿—ç§°æ‡’æ±‰æ¨¡å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">Singleton = _Singleton()  <span class="comment"># æƒ³è¦çš„å•ä¾‹</span></span><br></pre></td></tr></table></figure><p>å½“éœ€è¦ä½¿ç”¨è¿™ä¸ªå•ä¾‹æ—¶ï¼Œç›´æ¥ä½¿ç”¨ <code>Singlton</code> å®ä¾‹å³å¯ã€‚æœ€ç®€å•çš„æƒ…å†µæ˜¯åœ¨ç›´æ¥ä½¿ç”¨è¿™ä¸ªå•ä¾‹ï¼Œæ— è®ºæ˜¯åœ¨åŒä¸€æ®µä»£ç è¿˜æ˜¯ä»¥åŒ…çš„å½¢å¼å¼•ç”¨ã€‚ç¨å¾®æœ‰ç‚¹åŒºåˆ«çš„æ˜¯ï¼Œä»¥åŒ…çš„å½¢å¼å¼•ç”¨çš„è¯ï¼Œè¿˜éœ€è¦çŸ¥é“ <code>import</code> è¿™ä¸ªè¯­æ³•å¼•å…¥å˜é‡æ˜¯å•ä¾‹çš„ï¼Œä¿è¯äº† <code>Singleton</code> å˜é‡åœ°å€ä¸å‘ç”Ÿå˜åŒ–ã€‚æ›´å¦™çš„æ˜¯ï¼Œè¿™æ®µä»£ç ä¸ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šæœ‰å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¤šæ¬¡å®ä¾‹åŒ–çš„æƒ…å†µ(æ­£å¸¸ä½¿ç”¨çš„è¯)ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½¿ç”¨ <code>reload</code> é‡æ–°åŠ è½½è¿™ä¸ªåŒ…å«å•ä¾‹çš„åŒ…æ—¶ï¼Œå°†ä¼šäº§ç”Ÿæ–°çš„å®ä¾‹ã€‚è¿˜æœ‰å¦ä¸€ç‚¹ï¼Œä¸€èˆ¬ä¸å¸Œæœ›åœ¨å…¨å±€å­˜åœ¨è¿‡å¤šå˜é‡ï¼Œå¯èƒ½åœ¨æ— æ„ä¸­é€ æˆä¸éœ€è¦çš„å•ä¾‹çš„åˆ›å»ºï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼Œè¿™ç§å•ä¾‹ä¸å®¹æ˜“ç”±è‡ªå·±å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Œé™¤éä½ å¾ˆæ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆã€‚æœ€åï¼Œè¿™ç§æ¨¡å¼ä¸‹å¦‚æœæ–‡æ¡£ä¸­è¯´æ˜ä¸æ¸…æ™°ï¼Œæˆ–è€…è·Ÿå…¶ä»–å¼€å‘äººå‘˜äº¤æµä¸å¤Ÿæ˜ç™½ï¼Œæœ‰å¯èƒ½å¯¼è‡´æ‰‹åŠ¨å†åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå› ä¸º <code>_Singleton</code> è¿™ä¸ªç±»æ˜¯å¯ä»¥æ‰‹åŠ¨å†å®ä¾‹åŒ–çš„ã€‚</p><blockquote><p>è™½ç„¶å…¨å±€å­˜å‚¨çš„å½¢å¼çœ‹ä¸Šå»é—®é¢˜æŒºå¤šï¼Œä½†è¿™ç§æ–¹å¼å…¶å®æ­ç¤ºäº†å•ä¾‹æ¨¡å¼çš„é€šè¡Œåšæ³•â€”â€” ä¿å­˜å®ä¾‹</p><p>å…¶ä»–åˆ›å»ºå•ä¾‹çš„å½¢å¼æ— éæ˜¯è®©è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´åŠ å®‰å…¨å’Œå¥å£®äº†è€Œå·²</p></blockquote><h3 id="2-é™æ€å˜é‡å­˜å‚¨"><a href="#2-é™æ€å˜é‡å­˜å‚¨" class="headerlink" title="2. é™æ€å˜é‡å­˜å‚¨"></a>2. é™æ€å˜é‡å­˜å‚¨</h3><p>å°†å®ä¾‹å­˜å‚¨ä¸ºé™æ€å˜é‡çš„æ–¹å¼å°†è¯¥å®ä¾‹çš„è®¿é—®æƒé™ç¼©å°ä¸ºé€šè¿‡ç±»åŠå…¶å®ä¾‹ï¼Œç›¸å¯¹å…¨å±€è€Œè¨€æå‡äº†ä¸€å±‚æŠ½è±¡ã€‚æ®æˆ‘è§‚å¯Ÿï¼Œè¿™ä¹Ÿæ˜¯å®ç°å½¢å¼æœ€å¤šçš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯éšè—é—®é¢˜æœ€å¤šçš„ä¸€ç§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">      <span class="keyword">return</span> cls.__instance__</span><br><span class="line">    <span class="keyword">with</span> Singleton._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">        cls.__instance__ = object.__new__(cls)</span><br><span class="line">    <span class="keyword">return</span> cls.__instance__</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦åˆ©ç”¨äº† <code>__new__</code> æ–¹æ³•æ§åˆ¶å®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä½†æ˜¯æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹</p><h4 id="1-æ–°å¼ç±»"><a href="#1-æ–°å¼ç±»" class="headerlink" title="1) æ–°å¼ç±»"></a>1) æ–°å¼ç±»</h4><p>è¿™ä¸ªé—®é¢˜å­˜åœ¨äºpython2.7åŠä»¥ä¸‹</p><p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç±»å¿…é¡»æ˜¯ <code>object</code> çš„å­ç±»ï¼Œå¦åˆ™ <code>__new__</code> æ–¹æ³•å°†å¤±æ•ˆã€‚è¯´ç™½äº†ï¼Œ<code>__new__</code> æ–¹æ³•æ˜¯ <code>object</code> ç»™çš„</p><h4 id="2-é™æ€å˜é‡å"><a href="#2-é™æ€å˜é‡å" class="headerlink" title="2) é™æ€å˜é‡å"></a>2) é™æ€å˜é‡å</h4><p>é™æ€å˜é‡çš„åå­—ä¸èƒ½æ˜¯ç§æœ‰å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å·æ‡’ç»™å…¨å±€å˜é‡å‘½åä¸º <code>__instance</code></p><p>å› ä¸ºä¼šè¢«é‡å†™ä¸º <code>_Singleton__instance</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>hasattr(cls, &quot;__instance__&quot;)</code> æ°¸è¿œéƒ½æ˜¯ <code>False</code> ï¼Œå› æ­¤æ¯æ¬¡åˆ›å»ºå®ä¾‹æ—¶éƒ½ä¼šé‡å»ºå®ä¾‹</p><p>ä¸ºäº†é¿å…è¿™ç§éšå«é—®é¢˜ï¼Œå‡å°‘åŠ¨æ€å±æ€§çš„ä½¿ç”¨ï¼Œä¸€èˆ¬ä¹Ÿä¼šè¿™ä¹ˆå†™:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  _instance = <span class="keyword">None</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls._instance:</span><br><span class="line">      <span class="keyword">return</span> cls._instance</span><br><span class="line">    <span class="keyword">with</span> Singleton._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">        cls._instance = object.__new__(cls)</span><br><span class="line">    <span class="keyword">return</span> cls._instance</span><br></pre></td></tr></table></figure><h4 id="3-åˆå§‹åŒ–æ–¹æ³•é‡å¤æ‰§è¡Œ"><a href="#3-åˆå§‹åŒ–æ–¹æ³•é‡å¤æ‰§è¡Œ" class="headerlink" title="3) åˆå§‹åŒ–æ–¹æ³•é‡å¤æ‰§è¡Œ"></a>3) åˆå§‹åŒ–æ–¹æ³•é‡å¤æ‰§è¡Œ</h4><p><code>__init__</code> æ–¹æ³•ä½œä¸ºåˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨æ¯æ¬¡åˆ›å»ºå®ä¾‹å®Œæˆåéƒ½ä¼šé»˜è®¤æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åœ¨ <code>__new__</code> ä¹‹åè‡ªåŠ¨æ‰§è¡Œï¼Œæ‰€ä»¥å¦‚æœæœ‰ä»€ä¹ˆåªå¸Œæœ›åœ¨å•ä¾‹åˆ›å»ºæ—¶æ‰§è¡Œçš„åŠ¨ä½œä¸€å®šä¸èƒ½ç›´æ¥æ”¾åœ¨ <code>__init__</code> ä¸­</p><p>æ‰€ä»¥è¿™é‡Œä¹Ÿå°±æœ‰äº†å…¶ä»–å†™æ³•:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  _instance = <span class="keyword">None</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls._instance:</span><br><span class="line">      <span class="keyword">return</span> cls._instance</span><br><span class="line">    <span class="keyword">with</span> Singleton._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">        cls._instance = cls.get_instance()</span><br><span class="line">    <span class="keyword">return</span> cls._instance</span><br><span class="line">  </span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span><span class="params">(cls)</span>:</span>  <span class="comment"># ä½œç”¨ä¸ºå–ä»£ __init__ å…¼é¡¾åˆ›å»ºå®ä¾‹</span></span><br><span class="line">    <span class="comment"># do something heavy</span></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> object.__new__(cls)</span><br></pre></td></tr></table></figure><p>ä»¥åŠè¿™ç§å†™æ³•çš„é€€åŒ–å†™æ³•:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  _instance = <span class="keyword">None</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span><span class="params">(cls)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls._instance:</span><br><span class="line">      <span class="keyword">return</span> cls._instance</span><br><span class="line">    <span class="keyword">with</span> cls._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">        <span class="comment"># do something heavy</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"> </span><br><span class="line">instance = Singleton.get_instance()  <span class="comment"># æƒ³è¦çš„å•ä¾‹éœ€è¦è¿™æ ·ç”Ÿæˆ</span></span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯ä½¿ç”¨ç±»æ–¹æ³•ä»£æ›¿äº† <code>__new__</code> æ–¹æ³•ï¼Œå­˜å‚¨äº†ä¸€ä¸ªå®ä¾‹åˆ°é™æ€å˜é‡ <code>_instance</code> ã€‚å½“ç„¶ï¼Œæ¯”è¾ƒä¸çˆ½çš„åœ°æ–¹å°±æ˜¯å•ä¾‹çš„è·å–åªèƒ½é€šè¿‡è°ƒç”¨ç±»æ–¹æ³• <code>get_instance</code> è·å¾—</p><h4 id="4-å•ä¾‹æ¨¡å¼ä¸å¯ç»§æ‰¿"><a href="#4-å•ä¾‹æ¨¡å¼ä¸å¯ç»§æ‰¿" class="headerlink" title="4) å•ä¾‹æ¨¡å¼ä¸å¯ç»§æ‰¿"></a>4) å•ä¾‹æ¨¡å¼ä¸å¯ç»§æ‰¿</h4><p>è¿™é‡Œå¼ºè°ƒæ˜¯æ¨¡å¼ä¸å¯ç»§æ‰¿ï¼Œä¹Ÿå°±æ˜¯è¯´çˆ¶ç±»æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå­ç±»ä¸ä¼šä¸ç»ä¿®é¥°å°±æˆä¸ºå¤©ç„¶å•ä¾‹æ¨¡å¼ã€‚è€Œä¸”å¯¹äºç®€å•çš„ç»§æ‰¿ï¼Œå¯èƒ½ä¼šå‡ºå¤§é—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">      <span class="keyword">return</span> cls.__instance__</span><br><span class="line">    <span class="keyword">with</span> Singleton._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">        cls.__instance__ = object.__new__(cls)</span><br><span class="line">    <span class="keyword">return</span> cls.__instance__</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(Singleton)</span>:</span></span><br><span class="line">  key = <span class="string">"B"</span></span><br><span class="line"></span><br><span class="line">Singleton()</span><br><span class="line">B().key  <span class="comment"># AttributeError: 'Singleton' object has no attribute 'key'</span></span><br></pre></td></tr></table></figure><p>ç”±äº <code>B</code> ä¸ <code>Singleton</code> çš„å®ä¾‹å…±äº« <code>__instance__</code> é™æ€å˜é‡ï¼Œæ‰€ä»¥ç”±äº <code>Singleton</code> å…ˆå®ä¾‹åŒ–ï¼Œå¯¼è‡´ <code>B</code> çš„å®ä¾‹å…¶å®è¿˜æ˜¯ <code>Singleton</code> çš„å®ä¾‹</p><p>æ­£ç¡®çš„ç»§æ‰¿æ–¹å¼:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">      <span class="keyword">return</span> cls.__instance__</span><br><span class="line">    <span class="keyword">with</span> Singleton._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">        cls.__instance__ = object.__new__(cls)</span><br><span class="line">    <span class="keyword">return</span> cls.__instance__</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(Singleton)</span>:</span></span><br><span class="line">  key = <span class="string">"B"</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"></span><br><span class="line">Singleton()</span><br><span class="line">B().key</span><br><span class="line">B().__instance__</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè‡ªç„¶æœ‰ä¸€ç§å¯ä»¥ç»§æ‰¿å•ä¾‹æ¨¡å¼çš„æ–¹å¼:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">  _lock = Lock()</span><br><span class="line">  _instance = <span class="keyword">None</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">  @classmethod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span><span class="params">(cls)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> cls._instance:</span><br><span class="line">      <span class="keyword">return</span> cls._instance</span><br><span class="line">    <span class="keyword">with</span> cls._lock:</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</span><br><span class="line">        <span class="comment"># do something heavy</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(Singleton)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">Singleton.get_instance()</span><br><span class="line">A.get_instance()</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™ç§æ–¹æ³•çœ‹èµ·æ¥è¿˜æ˜¯æœ‰é‚£ä¹ˆä¸€ç‚¹ä¸‘ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€ç§ç¨å¾®é«˜çº§ä¸€ç‚¹çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯ <code>å…ƒç±»</code> ã€‚ä¸è¿‡å…ƒç±»åœ¨python2å’Œpython3ä¹‹é—´å·®å¼‚è¾ƒå¤§ï¼Œæ‰€ä»¥æ˜¯ä¸é€šç”¨çš„ï¼Œä½†æ˜¯åŸç†æ˜¯ç±»ä¼¼çš„ã€‚ä»¥ä¸‹ä»¥ <code>python2</code> ä½œä¸ºä¾‹å­</p><p>å…ƒç±»ä½œä¸ºç±»çš„ç±»ï¼Œæœ¬è´¨ä¸Šåªæ˜¯ç»™å‡ºäº†ç±»åˆ›å»ºæ—¶å€™çš„æ¨¡æ¿ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¾é ç±»æœ¬èº«çš„ç‰¹æ€§å®ç°çš„ã€‚å¯ä»¥çœ‹çœ‹å¦‚ä¸‹ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonMeta</span><span class="params">(type)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, name, bases, attrs)</span>:</span></span><br><span class="line">    _lock = Lock()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">      <span class="keyword">if</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">        <span class="keyword">return</span> cls.__instance__</span><br><span class="line">      <span class="keyword">with</span> _lock:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">"__instance__"</span>):</span><br><span class="line">          cls.__instance__ = object.__new__(cls)</span><br><span class="line">      <span class="keyword">return</span> cls.__instance__</span><br><span class="line">    attrs[<span class="string">"__new__"</span>] = new</span><br><span class="line">    <span class="keyword">return</span> type.__new__(cls, name, bases, attrs)</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonA</span><span class="params">(object)</span>:</span></span><br><span class="line">  __metaclass__ = SingletonMeta</span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonB</span><span class="params">(object)</span>:</span></span><br><span class="line">  __metaclass__ = SingletonMeta</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¾‹å­æœ¬è´¨ä¸Šè¿˜æ˜¯ä¾èµ– <code>__new__</code> æ–¹æ³•å®ç°ï¼Œåªæ˜¯å°† <code>__new__</code> æ–¹æ³•çš„å®ç°æ¨¡æ¿åŒ–ï¼Œä½¿ç”¨å…ƒç±»å®ç°ç±»çš„é‡äº§</p><h3 id="3-å¤–éƒ¨å˜é‡å­˜å‚¨"><a href="#3-å¤–éƒ¨å˜é‡å­˜å‚¨" class="headerlink" title="3. å¤–éƒ¨å˜é‡å­˜å‚¨"></a>3. å¤–éƒ¨å˜é‡å­˜å‚¨</h3><p>ä¸€æåˆ°å¤–éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå°±ä¼šæåˆ°é—­åŒ…ï¼Œä¸€æåˆ°é—­åŒ…ï¼Œå°±ä¼šè¯´åˆ°è£…é¥°å™¨ã€‚ç”±äºè£…é¥°å™¨çš„æœ¬è´¨å…¶å®éƒ½æ˜¯å¯æ‰§è¡Œå¯¹è±¡(å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½è¯´çš„æ˜¯å‡½æ•°)ï¼Œæ‰€ä»¥ä»¥ä¸‹ä»¥æ™®é€šè£…é¥°å™¨ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(name)</span>:</span></span><br><span class="line">  _instance = &#123;&#125;</span><br><span class="line">  _lock = Lock()</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cls_wrapper</span><span class="params">(cls)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(cls)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">      <span class="keyword">if</span> name <span class="keyword">in</span> _instance:</span><br><span class="line">        <span class="keyword">return</span> _instance[name]</span><br><span class="line">      <span class="keyword">with</span> _lock:</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> _instance:</span><br><span class="line">        	_instance[name] = cls(*args, **kwargs)</span><br><span class="line">      <span class="keyword">return</span> _instance[name]</span><br><span class="line">    <span class="keyword">return</span> init_wrapper</span><br><span class="line">  <span class="keyword">return</span> cls_wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton("A")</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œå‡è®¾å¯¹pythonä¸­çš„å­—å…¸ç»“æ„è¿›è¡ŒåŠ keyä¸æŸ¥è¯¢keyçš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„</p></blockquote><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹åˆ›å»ºå•ä¾‹ä¸å†éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„æ‰‹å†™ï¼Œè€Œæ˜¯é€šè¿‡è£…é¥°å™¨è¿›è¡ŒåŒ…è£…ã€‚è¿™ç§æ–¹å¼çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå³ä½¿ä¸€ä¸ªå·²ç»å†™å¥½çš„ç±»ä¸æ˜¯å•ä¾‹ï¼Œä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨å¼ºè¡Œè½¬å˜ä¸ºå•ä¾‹ã€‚è¿™ä¸ªä¾‹å­é‡Œå¯èƒ½æœ‰ä¸€äº›åœ°æ–¹éœ€è¦ç‰¹åˆ«æŒ‡å‡º(å¹¶ä¸æ˜¯æ— æ„ä¸ºä¹‹)</p><blockquote><p>å…³äºè£…é¥°å™¨çš„ä¸€äº›é—®é¢˜åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ä¼šè¯¦ç»†æ•´ç†</p></blockquote><h4 id="1-è¿™æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨"><a href="#1-è¿™æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨" class="headerlink" title="1) è¿™æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨"></a>1) è¿™æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨</h4><p>é¦–å…ˆï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯ä½œä¸ºå®ä¾‹åœ¨å¤–éƒ¨å­—å…¸ <code>_instance</code> ä¸­çš„keyï¼Œå…¶æ¬¡è¿™ä¸ªkeyå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è·å–(ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸å¸¦å‚æ•°çš„è£…é¥°å™¨å®ç°)ã€‚å½“ç„¶ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­å°±åªæœ‰ä¸€ä¸ªç±»éœ€è¦ä½œä¸ºå•ä¾‹æ¥ä½¿ç”¨ï¼Œå¯ä»¥å°†keyå›ºå®šä¸º <code>instance</code> ç±»ä¼¼çš„å­—ç¬¦ä¸²(è™½ç„¶æˆ‘è§‰å¾—æ²¡æœ‰å¤šå°‘äººä¼šè¿™ä¹ˆåš)ï¼Œç”šè‡³å°†æ•´ä¸ªå®ä¾‹å ç”¨å•ä¸ªå¤–éƒ¨å˜é‡(ä½†æ˜¯å¦‚æœæ˜¯ä¿®æ”¹å¤–éƒ¨å˜é‡ä¼šæ¶‰åŠåˆ°å†…å¤–éƒ¨ä½œç”¨åŸŸçš„é—®é¢˜ï¼Œä¼šç”¨åˆ°å¼•ç”¨ä¼ é€’æˆ–è€… <code>nonlocal</code> ç­‰)</p><p>å¦‚ä½•è®© <code>singleton</code> ä¸å¸¦å‚æ•°ä½¿ç”¨ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls)</span>:</span></span><br><span class="line">  _instance = &#123;&#125;</span><br><span class="line">  _lock = Lock()</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># name = __file__ + cls.__name__  # åœ¨äº¤äº’å¼shellç¯å¢ƒä¸­è¯·å»æ‰ __file__</span></span><br><span class="line">  name = repr(cls)  <span class="comment"># è¿™ä¸ªnameå¯èƒ½æ²¡æœ‰ä¸Šé¢é‚£ä¹ˆå¥½çœ‹ï¼Œä½†æ˜¯å¥½ç”¨è€Œä¸”é€šç”¨ =.=</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">  @wraps(cls)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init_wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> _instance:</span><br><span class="line">      <span class="keyword">return</span> _instance[name]</span><br><span class="line">    <span class="keyword">with</span> _lock:</span><br><span class="line">      <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> _instance:</span><br><span class="line">        _instance[name] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> _instance[name]</span><br><span class="line">  <span class="keyword">return</span> init_wrapper</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°ä¸€ä¸ªå¯èƒ½ä¸å­˜åœ¨çš„å…¨å±€å˜é‡ <code>__file__</code> ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åœ¨ä¸åŒpythonæ–‡ä»¶ä¸­å­˜åœ¨åŒåçš„ç±»ï¼Œå¦‚æœä¸è§‰å¾—keyä¸‘çš„è¯ <code>name = repr(cls)</code> ä¹Ÿå¯ä»¥(å…¶å®è¿™æ ·çš„ä»£ç åè€Œçœ‹èµ·æ¥å¾ˆæ¸…æ™°=ã€‚=)</p><h4 id="2-wrapsè£…é¥°å•ä¾‹ç±»"><a href="#2-wrapsè£…é¥°å•ä¾‹ç±»" class="headerlink" title="2) wrapsè£…é¥°å•ä¾‹ç±»"></a>2) wrapsè£…é¥°å•ä¾‹ç±»</h4><p>wrapsçš„ä½œç”¨åœ¨äºæ¢å¤è¢«è£…é¥°ç±»çš„åŸºæœ¬å…ƒä¿¡æ¯(å¯¹ï¼Œä¸ä»…å¯ä»¥æ¢å¤å‡½æ•°çš„å…ƒä¿¡æ¯ï¼Œè¿˜å¯ä»¥æ¢å¤ç±»çš„å…ƒä¿¡æ¯)ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä¿ç•™ <code>__module__</code>, <code>__name__</code>, <code>__doc__</code> ä¸‰ä¸ªå…ƒå˜é‡æ•°æ®</p><h4 id="3-çº¿ç¨‹é”-Lock"><a href="#3-çº¿ç¨‹é”-Lock" class="headerlink" title="3) çº¿ç¨‹é” Lock"></a>3) çº¿ç¨‹é” Lock</h4><p><code>_lock</code> é”å®ä¾‹åœ¨æ¯æ¬¡è£…é¥°ç±»æ—¶å®ä¾‹åŒ–ï¼Œåœ¨ <code>with _lock</code> æ—¶æ§åˆ¶ä»£ç ç‰‡æ®µè®¿é—®åºåˆ—ã€‚åœ¨ä¸€å¼€å§‹é¦–å…ˆåˆ¤æ–­å®ä¾‹æ˜¯å¦åˆ›å»ºï¼Œå¦‚æœå·²ç»åˆ›å»ºï¼Œåˆ™ç«‹å³è¿”å›è¯¥å®ä¾‹ï¼›å¦‚æœæ²¡æœ‰åˆ›å»ºï¼Œåˆ™é€šè¿‡åŠ é”æ–¹å¼åˆ›å»ºå•ä¾‹ã€‚</p><p>åœ¨é”ä¸­åˆåˆ¤æ–­ä¸€æ¬¡è¯¥å®ä¾‹æ˜¯å¦åˆ›å»ºï¼Œæ˜¯æœ‰å¿…è¦çš„ï¼Œè€ƒè™‘å¦‚ä¸‹ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Delay</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å¼€å§‹å®ä¾‹åŒ–æ—¶éƒ½ä¼šå‘ç° <code>_instance</code> ä¸­æ— è¯¥å®ä¾‹ï¼Œåœ¨é”çš„å®‰æ’ä¸‹ï¼Œä¼šä¾æ¬¡è¿›å…¥ä¸´ç•ŒåŒºï¼Œåˆ›å»ºå®ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹è¦ç­‰å¾…10sä¹‹ä¹…ï¼Œæ‰€æœ‰çš„çº¿ç¨‹ä¸€å®šéƒ½ä¼šå°è¯•ä¸€éåˆ›å»ºå®ä¾‹ï¼Œå¦‚æœä¸åˆ¤æ–­å®ä¾‹æ˜¯å¦å·²ç»è¢«åˆ«çš„çº¿ç¨‹åˆ›å»ºäº†ï¼Œé‚£ä¸€å®šä¼šå‡ºç°å¤šæ¬¡å®ä¾‹åŒ–ã€‚å½“ç„¶ï¼Œæœ€ç»ˆçš„ç¡®åªä¼šæ®‹ç•™ä¸€ä¸ªå®ä¾‹ã€‚</p><p>æ‰€ä»¥ï¼Œé” + å­˜åœ¨åˆ¤æ–­æ˜¯ä¸ºäº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä»å§‹è‡³ç»ˆåªç”Ÿæˆä¸€ä¸ªæ­£ç¡®çš„å®ä¾‹ã€‚</p><h4 id="4-è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨"><a href="#4-è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨" class="headerlink" title="4) è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨"></a>4) è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨</h4><p>æ„å‘³ç€å•ä¾‹è¢«ä½¿ç”¨å‡½æ•°åˆ›å»ºå‡ºæ¥ï¼Œè¢«è£…é¥°çš„å•ä¾‹ç±»å†ä¹Ÿä¸æ˜¯ç±»(è‡³å°‘ä¸æ˜¯è¡¨é¢ä¸Šçœ‹èµ·æ¥çš„ç±»)ï¼Œè€Œæ˜¯å‡½æ•°ï¼Œæœ€ç®€å•çš„éªŒè¯æ–¹å¼å°±æ˜¯:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type(A)  <span class="comment"># function</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæ­¤æ—¶ç±»å·²ç»è¢«æ›¿æ¢æˆäº† <code>cls_wrapper</code> (å¸¦å‚æ•°) æˆ–è€… <code>init_wrapper</code> (ä¸å¸¦å‚æ•°)äº†</p><p>æ‰€ä»¥ä¸¢å¤±äº†åŸæ¥ç”¨ç±»æ¥åˆ¤æ–­çš„èƒ½åŠ›ï¼Œæ¯”å¦‚ <code>isinstance</code> ï¼Œ<code>__class__</code> ç­‰ç­‰</p><h4 id="5-åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡"><a href="#5-åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡" class="headerlink" title="5) åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡"></a>5) åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡</h4><p>å’Œä¸Šä¸€ç±»å®ç°æ–¹å¼ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™é‡Œçš„å•ä¾‹åªä¼šæ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–æ“ä½œã€‚æŸç§æ„ä¹‰ä¸Šç®—æ˜¯å¾ˆæ–¹ä¾¿çš„ä¸€ä¸ªç‰¹æ€§</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å®é™…æƒ…å†µä¸­ï¼Œæ¯ä¸ªäººéƒ½ä¼šæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå•ä¾‹çš„å®è·µï¼Œç”šè‡³å¤šç§æ–¹å¼ç»„åˆä½¿ç”¨ã€‚ä¸è¿‡åˆ›å»ºå•ä¾‹çš„æ€æƒ³ä¸€ç›´éƒ½æ²¡æœ‰å˜è¿‡ï¼šå¸¸é©»å†…å­˜+çº¿ç¨‹å®‰å…¨</p></div></div><div class="copy-right"><div class="markdown-body"><blockquote> æœ¬æ–‡ä½œè€… : hellflame<br> åŸæ–‡é“¾æ¥ : <a href="">https://hellflame.github.io/2019/10/04/singleton-in-python/</a><br> ç‰ˆæƒå£°æ˜ : æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</blockquote></div></div><div class="social-share" style="margin-top:-2rem" data-wechat-qrcode-title="<p>å¾®ä¿¡æ‰«ä¸€æ‰«</p>" data-wechat-qrcode-helper="<p>å¾®ä¿¡å³ä¸Šè§’, æ‰«ä¸€æ‰«åˆ†äº«</p>" data-sites="qzone, qq, weibo, facebook, twitter"> <span style="color:#6b7487;font-size:1.4rem">åˆ†äº«åˆ°:</span></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js" async></script><div class="article-footer"><div class="article-meta pull-left"><span><i class="iconfont icon-06tags"></i> æ ‡ç­¾: <span class="span--tag"><a href="/tags/python/">#python</a></span></span></div><div class="article-meta pull-right"></div></div></div><aside id="sidebar"><p id="sidebar-header"></p><ol id="sidebar-toc"></ol></aside><script async>getTOC().length||$("#toc").remove()</script><nav class="post-navigation"><div class="nav-pre"><i class="iconfont icon-prev"></i> ä¸Šä¸€ç¯‡: <a href="/2019/09/30/guilin-park-2/" target="_self">æ¡‚æ—å…¬å›­(äºŒ)</a></div><div class="nav-next"> ä¸‹ä¸€ç¯‡: <a href="/2019/10/05/decorators-in-python/" target="_self">è§£æPythonä¸­çš„è£…é¥°å™¨</a><i class="iconfont icon-next"></i></div></nav><a href="#comment" class="comment-anchor"></a><div class="comment-title"><i class="iconfont icon-footprint"></i> ç•™ä¸‹è¶³è¿¹<i class="iconfont icon-footprint"></i></div> <a style="margin-bottom:1em;display:block;cursor:pointer" onclick="gotoComment()">é€šè¿‡issueç•™è¨€</a><div id="vcomments"></div><script defer="defer">new Valine({el:"#vcomments",appId:"a",appKey:"b",notify:!1,verify:!1,avatar:"robohash",placeholder:"ä¸å¡«é‚®ç®±ï¼Œç½‘å€, ä¹Ÿèƒ½æ”¶åˆ°å›å¤å“¦â™ª(^âˆ‡^*)\nå½“ç„¶ä¹Ÿä¸ä¸€å®šä¼šå›å¤-_-",path:getRealPath()})</script><script defer="defer">
   function gotoComment() {
    location.href = `https://github.com/hellflame/hellflame.github.io/issues/new?title=å…³äº%0Aâ€œ%E8%A7%A3%E6%9E%90Python%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8Bâ€&body=%23%23%23%20[åŸæ–‡åœ°å€](https://hellflame.github.io/2019/10/04/singleton-in-python/)%0A%0A%23%23%23%20æƒ³è¯´çš„è¯(é—®é¢˜/æ”¯æŒ/å¼‚è®®)%20%20%0A%0A${document.getElementById('veditor').value}`
   }
   document.onreadystatechange = (e) => {
     if(document.readyState === 'complete') {
      setTimeout(() => {
        const target = document.getElementsByClassName("vsubmit vbtn")[0]
        target.outerHTML = target.outerHTML
        setTimeout(() => {
          document.getElementsByClassName("vsubmit vbtn")[0].addEventListener('click', gotoComment)
          console.log("event replaced")
        }, 1000)
        document.getElementsByClassName("power txt-right")[0].innerHTML = "Once powered by Valine"
      }, 1000)
     }
   }
 </script></div><footer><p class="site-info"> åšå®¢å·²èŒèŒå“’è¿è¡Œ<span id="time-to-now"></span><span class="my-face">(â—'â—¡'â—)ï¾‰â™¥</span><br> Theme - <a target="_blank" href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With ğŸ’— | Powered by GodBMW & hellflame<br></p></footer><script src="/js/footer.js"></script><script>updateUptime(2016,3,27)</script><div class="back-to-top hidden"><span><i class="iconfont icon-60"></i><span></span> %</span></div><script src="/js/component/back-to-top.js"></script></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script src="/js/mathjax.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js" async></script><script async src="/js/fancybox.js"></script></body></html>